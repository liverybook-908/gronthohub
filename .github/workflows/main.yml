name: ðŸ“š Bengali Book Automation Suite

on:
  schedule:
    # à¦ªà§à¦°à¦¤à¦¿à¦¦à¦¿à¦¨ à¦°à¦¾à¦¤ à§¨à¦Ÿà¦¾ à§©à§¦ à¦®à¦¿à¦¨à¦¿à¦Ÿà§‡ à¦°à¦¾à¦¨ à¦¹à¦¬à§‡ (à¦¨à¦¤à§à¦¨ à¦¬à¦‡ à¦–à§‹à¦à¦œà¦¾ à¦à¦¬à¦‚ à¦à¦¸à¦‡à¦“ à¦•à¦°à¦¾à¦° à¦œà¦¨à§à¦¯)
    - cron: '30 2 * * *'
  
  # à¦—à¦¿à¦Ÿà¦¹à¦¾à¦¬ à¦¥à§‡à¦•à§‡ à¦®à§à¦¯à¦¾à¦¨à§à¦¯à¦¼à¦¾à¦²à¦¿ à¦°à¦¾à¦¨ à¦•à¦°à¦¾à¦° à¦…à¦ªà¦¶à¦¨
  workflow_dispatch:

permissions:
  contents: write # à¦¸à§à¦²à¦¾à¦‡à¦Ÿà¦®à§à¦¯à¦¾à¦ª à¦†à¦ªà¦¡à§‡à¦Ÿ à¦•à¦°à§‡ à¦—à¦¿à¦Ÿà¦¹à¦¾à¦¬à§‡ à¦ªà§à¦¶ à¦•à¦°à¦¾à¦° à¦ªà¦¾à¦°à¦®à¦¿à¦¶à¦¨

jobs:
  automation-task:
    name: ðŸš€ Full Automation Run
    runs-on: ubuntu-latest
    timeout-minutes: 20

    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ðŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ðŸ“¦ Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install google-generativeai internetarchive firebase-admin requests google-auth google-auth-oauthlib google-auth-httplib2

      - name: ðŸ¤– Run Hunter (Find New Books)
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          FIREBASE_KEYS: ${{ secrets.FIREBASE_KEYS }}
        run: |
          echo "ðŸ“ Starting Hunter Bot..."
          python hunter.py

      - name: ðŸ”§ Run Fixer (Link Integrity)
        env:
          FIREBASE_KEYS: ${{ secrets.FIREBASE_KEYS }}
        run: |
          echo "ðŸ› ï¸ Starting Database Fixer..."
          python fixer.py

      - name: ðŸš€ Run Promoter
        env:
          FIREBASE_KEYS: ${{ secrets.FIREBASE_KEYS }}
          SITE_URL: "https://your-site.web.app"
          SITE_NAME: "à¦¬à¦‡à¦˜à¦°"
        run: python promoter.py

      - name: ðŸ“¤ Commit & Push Changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # public à¦«à§‹à¦²à§à¦¡à¦¾à¦°à§‡ à¦¥à¦¾à¦•à¦¾ sitemap à¦¬à¦¾ à¦…à¦¨à§à¦¯à¦¾à¦¨à§à¦¯ à¦«à¦¾à¦‡à¦² à¦…à§à¦¯à¦¾à¦¡ à¦•à¦°à¦¾
          git add public/sitemap.xml || true
          
          if git diff --staged --quiet; then
            echo "ðŸ“­ No changes to commit"
          else
            git commit -m "ðŸ¤– Auto-update: Sitemap [$(date +'%Y-%m-%d %H:%M')]"
            git push
            echo "âœ… Changes pushed to repository"
          fi

      - name: ðŸ“¢ Generate Summary
        if: always()
        run: |
          echo "## ðŸ¤– Automation Run Summary" >> $GITHUB_STEP_SUMMARY
          echo "Date: $(date)" >> $GITHUB_STEP_SUMMARY
          echo "Status: Execution Completed" >> $GITHUB_STEP_SUMMARY
